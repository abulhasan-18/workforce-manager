<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Employees â€¢ Workforce Manager</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
  </head>
  <body>
    <div class="app">
      <header class="topbar">
        <div class="brand">
          <div class="logo">WM</div>
          <div>
            <div class="title">Workforce Manager</div>
            <div class="subtitle">Employee Management</div>
          </div>
        </div>

        <div class="actions">
          <!-- Only ADMIN + HR can add -->
          <a
            class="btn ghost"
            th:href="@{/employees/new}"
            sec:authorize="hasAnyRole('ADMIN','HR')"
          >
            + Add Employee
          </a>

          <form th:action="@{/logout}" method="post">
            <input
              type="hidden"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
            />
            <button class="btn danger" type="submit">Logout</button>
          </form>
        </div>
      </header>

      <main class="container">
        <div class="card">
          <div class="card-head">
            <div>
              <h2>Employees</h2>
              <p class="muted" style="margin: 6px 0 0">
                Logged in as:
                <b sec:authentication="name"></b>
                <span
                  class="pill soft"
                  style="margin-left: 8px"
                  sec:authentication="principal.authorities"
                ></span>
              </p>
            </div>

            <form class="search" th:action="@{/employees}" method="get">
              <input
                type="text"
                name="q"
                placeholder="Search name / email / dept / designation..."
                th:value="${q}"
              />
              <button class="btn" type="submit">Search</button>
            </form>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Full Name</th>
                  <th>Email</th>
                  <th>Department</th>
                  <th>Designation</th>
                  <th>Status</th>
                  <th>Role</th>
                  <th class="right">Actions</th>
                </tr>
              </thead>

              <tbody>
                <tr th:if="${#lists.isEmpty(employees)}">
                  <td colspan="8" class="muted">No employees found.</td>
                </tr>

                <tr th:each="e : ${employees}">
                  <td th:text="${e.id}"></td>
                  <td th:text="${e.fullName}"></td>
                  <td th:text="${e.email}"></td>
                  <td th:text="${e.department}"></td>
                  <td th:text="${e.designation}"></td>
                  <td><span class="pill" th:text="${e.status}"></span></td>
                  <td><span class="pill soft" th:text="${e.role}"></span></td>

                  <td class="right">
                    <!-- Everyone can view -->
                    <a
                      class="btn mini ghost"
                      th:href="@{/employees/{id}(id=${e.id})}"
                      title="View"
                      aria-label="View"
                    >
                      <!-- Eye icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="vertical-align: middle"
                      >
                        <path
                          d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"
                        ></path>
                        <circle cx="12" cy="12" r="3"></circle>
                      </svg>
                    </a>

                    <!-- Only ADMIN + HR can edit -->
                    <a
                      class="btn mini"
                      th:href="@{/employees/{id}/edit(id=${e.id})}"
                      sec:authorize="hasAnyRole('ADMIN','HR')"
                      title="Edit"
                      aria-label="Edit"
                    >
                      <!-- Pencil icon -->
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        style="vertical-align: middle"
                      >
                        <path d="M12 20h9"></path>
                        <path
                          d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4Z"
                        ></path>
                      </svg>
                    </a>

                    <!-- Only ADMIN can delete -->
                    <form
                      th:action="@{/employees/{id}/delete(id=${e.id})}"
                      method="post"
                      style="display: inline"
                      sec:authorize="hasRole('ADMIN')"
                    >
                      <input
                        type="hidden"
                        th:name="${_csrf.parameterName}"
                        th:value="${_csrf.token}"
                      />
                      <button
                        class="btn mini danger"
                        type="submit"
                        title="Delete"
                        aria-label="Delete"
                        onclick="return confirm('Delete this employee?');"
                      >
                        <!-- Trash icon -->
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          style="vertical-align: middle"
                        >
                          <path d="M3 6h18"></path>
                          <path d="M8 6V4h8v2"></path>
                          <path d="M19 6l-1 14H6L5 6"></path>
                          <path d="M10 11v6"></path>
                          <path d="M14 11v6"></path>
                        </svg>
                      </button>
                    </form>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
